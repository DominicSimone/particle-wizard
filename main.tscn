[gd_scene load_steps=34 format=2]

[ext_resource path="res://textures/temp ground.png" type="Texture" id=1]
[ext_resource path="res://scripts/PlayerController.gd" type="Script" id=2]
[ext_resource path="res://scripts/Enemy.gd" type="Script" id=3]
[ext_resource path="res://scripts/ParticleCollisions.gd" type="Script" id=4]
[ext_resource path="res://shaders/beam.gdshader" type="Shader" id=5]
[ext_resource path="res://scripts/ParticleEntity.gd" type="Script" id=6]
[ext_resource path="res://scripts/MainUI.gd" type="Script" id=7]
[ext_resource path="res://scripts/Shield.gd" type="Script" id=8]
[ext_resource path="res://shaders/force_field.gdshader" type="Shader" id=9]
[ext_resource path="res://objects/gem.obj" type="ArrayMesh" id=10]

[sub_resource type="StyleBoxFlat" id=32]
bg_color = Color( 0.513726, 0.0745098, 0.0392157, 1 )

[sub_resource type="StyleBoxEmpty" id=31]

[sub_resource type="StyleBoxFlat" id=34]
bg_color = Color( 0.0941176, 0.0823529, 0.431373, 1 )

[sub_resource type="Animation" id=35]
resource_name = "Low_Mana"
tracks/0/type = "value"
tracks/0/path = NodePath("Mana:custom_styles/fg:bg_color")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/keys = {
"times": PoolRealArray( 0, 0.2, 0.4, 0.6, 0.8 ),
"transitions": PoolRealArray( 1, 1, 1, 1, 1 ),
"update": 0,
"values": [ Color( 0.0941176, 0.0823529, 0.431373, 1 ), Color( 0.619608, 0.266667, 0.862745, 1 ), Color( 0.0941176, 0.0823529, 0.431373, 1 ), Color( 0.619608, 0.266667, 0.862745, 1 ), Color( 0.0941176, 0.0823529, 0.431373, 1 ) ]
}

[sub_resource type="Animation" id=36]
length = 0.001
tracks/0/type = "value"
tracks/0/path = NodePath("Mana:custom_styles/fg:bg_color")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/keys = {
"times": PoolRealArray( 0 ),
"transitions": PoolRealArray( 1 ),
"update": 0,
"values": [ Color( 0.0941176, 0.0823529, 0.431373, 1 ) ]
}

[sub_resource type="BoxShape" id=29]
extents = Vector3( 128.184, 127.235, 0.267175 )

[sub_resource type="CubeMesh" id=1]

[sub_resource type="ShaderMaterial" id=16]
shader = ExtResource( 5 )
shader_param/direction = Vector3( 0, 0, -1 )
shader_param/spread = 15.0
shader_param/flatness = 0.5
shader_param/initial_linear_velocity = 15.0
shader_param/initial_angle = 0.0
shader_param/angular_velocity = 0.0
shader_param/orbit_velocity = 0.0
shader_param/linear_accel = 0.0
shader_param/radial_accel = 0.0
shader_param/tangent_accel = 0.0
shader_param/damping = 0.0
shader_param/scale = 1.0
shader_param/hue_variation = 0.0
shader_param/anim_speed = 0.0
shader_param/anim_offset = 0.0
shader_param/initial_linear_velocity_random = 0.0
shader_param/initial_angle_random = 0.0
shader_param/angular_velocity_random = 0.0
shader_param/orbit_velocity_random = 0.0
shader_param/linear_accel_random = 0.0
shader_param/radial_accel_random = 0.0
shader_param/tangent_accel_random = 0.0
shader_param/damping_random = 0.0
shader_param/scale_random = 0.0
shader_param/hue_variation_random = 0.0
shader_param/anim_speed_random = 0.0
shader_param/anim_offset_random = 0.0
shader_param/lifetime_randomness = 0.0
shader_param/emission_sphere_radius = 0.5
shader_param/color_value = Color( 1, 1, 1, 1 )
shader_param/trail_divisor = 1
shader_param/gravity = Vector3( 0, -1e-06, 0 )
shader_param/player_collider = null
shader_param/gravity_point = Plane( 0, 0, 0, 0 )

[sub_resource type="SpatialMaterial" id=13]
vertex_color_use_as_albedo = true

[sub_resource type="CubeMesh" id=14]
material = SubResource( 13 )
size = Vector3( 0.2, 0.2, 0.2 )

[sub_resource type="ParticlesMaterial" id=6]
lifetime_randomness = 0.25
emission_shape = 1
emission_sphere_radius = 1.0
spread = 180.0
flatness = 0.5
gravity = Vector3( 0, 0, 0 )
initial_velocity = 2.0
initial_velocity_random = 1.0
radial_accel = -5.0
radial_accel_random = 1.0

[sub_resource type="SpatialMaterial" id=11]
vertex_color_use_as_albedo = true

[sub_resource type="CubeMesh" id=5]
material = SubResource( 11 )
size = Vector3( 0.2, 0.2, 0.2 )

[sub_resource type="ParticlesMaterial" id=12]
emission_shape = 1
emission_sphere_radius = 0.5
direction = Vector3( 0, 0, -1 )
spread = 15.0
flatness = 0.5
gravity = Vector3( 0, 0, 0 )
initial_velocity = 15.0

[sub_resource type="SphereShape" id=42]
radius = 1.50484

[sub_resource type="ShaderMaterial" id=41]
shader = ExtResource( 9 )
shader_param/albedo = Color( 0.52549, 0.607843, 0.831373, 1 )
shader_param/emission_color = Color( 0.415686, 0.341176, 0.368627, 1 )
shader_param/emission_amount = 10.0
shader_param/rim_steepness = 3.0
shader_param/uv_scale = null
shader_param/uv_offset = null

[sub_resource type="SphereMesh" id=40]
material = SubResource( 41 )
radius = 1.5
height = 3.0
radial_segments = 20
rings = 12

[sub_resource type="Animation" id=43]
resource_name = "Hit"
length = 0.5
tracks/0/type = "value"
tracks/0/path = NodePath("MeshInstance:mesh:material:shader_param/emission_color")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/keys = {
"times": PoolRealArray( 0, 0.5 ),
"transitions": PoolRealArray( 1, 1 ),
"update": 0,
"values": [ Color( 0.862745, 0.0352941, 0.341176, 1 ), Color( 0.415686, 0.341176, 0.368627, 1 ) ]
}

[sub_resource type="Animation" id=44]
length = 0.001
tracks/0/type = "value"
tracks/0/path = NodePath("MeshInstance:mesh:material:shader_param/albedo")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/keys = {
"times": PoolRealArray( 0 ),
"transitions": PoolRealArray( 1 ),
"update": 0,
"values": [ Color( 0.52549, 0.607843, 0.831373, 1 ) ]
}
tracks/1/type = "value"
tracks/1/path = NodePath("MeshInstance:mesh:material:shader_param/emission_color")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/keys = {
"times": PoolRealArray( 0 ),
"transitions": PoolRealArray( 1 ),
"update": 0,
"values": [ Color( 0.415686, 0.341176, 0.368627, 1 ) ]
}

[sub_resource type="SpatialMaterial" id=45]
albedo_color = Color( 0.14902, 0.917647, 0.478431, 1 )
roughness = 0.15

[sub_resource type="SphereShape" id=33]
radius = 0.910449

[sub_resource type="Animation" id=38]
length = 0.001
tracks/0/type = "value"
tracks/0/path = NodePath("gem:rotation_degrees")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/keys = {
"times": PoolRealArray( 0 ),
"transitions": PoolRealArray( 1 ),
"update": 0,
"values": [ Vector3( 0, 0, 0 ) ]
}

[sub_resource type="Animation" id=39]
resource_name = "Spin"
length = 3.0
loop = true
tracks/0/type = "value"
tracks/0/path = NodePath("gem:rotation_degrees")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/keys = {
"times": PoolRealArray( 0, 3 ),
"transitions": PoolRealArray( 1, 1 ),
"update": 0,
"values": [ Vector3( 0, 0, 0 ), Vector3( 0, -72, 0 ) ]
}

[node name="Spatial" type="Spatial"]

[node name="DirectionalLight" type="DirectionalLight" parent="."]
transform = Transform( 1, 0, 0, 0, 0.36234, 0.932046, 0, -0.932046, 0.36234, 0, 8.13306, 0.396632 )
light_energy = 0.5
shadow_enabled = true

[node name="Control" type="Control" parent="."]
anchor_right = 1.0
anchor_bottom = 1.0
mouse_filter = 2
script = ExtResource( 7 )

[node name="Health" type="ProgressBar" parent="Control"]
anchor_right = 1.0
margin_bottom = 9.0
custom_styles/fg = SubResource( 32 )
custom_styles/bg = SubResource( 31 )
value = 50.0
percent_visible = false

[node name="Mana" type="ProgressBar" parent="Control"]
anchor_top = 1.0
anchor_right = 1.0
anchor_bottom = 1.0
margin_top = -10.0
rect_pivot_offset = Vector2( 299, 6 )
custom_styles/fg = SubResource( 34 )
custom_styles/bg = SubResource( 31 )
value = 50.0
percent_visible = false

[node name="AnimationPlayer" type="AnimationPlayer" parent="Control/Mana"]
root_node = NodePath("../..")
anims/Low_Mana = SubResource( 35 )
anims/RESET = SubResource( 36 )

[node name="ColorRect" type="ColorRect" parent="Control"]
visible = false
anchor_right = 0.108
anchor_bottom = 0.162
margin_right = 0.199997
margin_bottom = 0.199997
color = Color( 0.207843, 0.207843, 0.207843, 1 )
__meta__ = {
"_editor_description_": ""
}

[node name="ViewportContainer" type="ViewportContainer" parent="Control"]
visible = false
anchor_right = 0.108
anchor_bottom = 0.162
margin_right = 0.199997
margin_bottom = 0.199997
stretch = true

[node name="Viewport" type="Viewport" parent="Control/ViewportContainer"]
size = Vector2( 65, 65 )
handle_input_locally = false
render_target_update_mode = 0

[node name="Camera" type="Camera" parent="Control/ViewportContainer/Viewport"]
transform = Transform( 1, 0, 0, 0, -4.37114e-08, 1, 0, -1, -4.37114e-08, 0, -0.634983, 2.7756e-08 )
cull_mask = 1048574
h_offset = -0.1
v_offset = 0.2
projection = 1
size = 1.75
near = 0.02
far = 232.8

[node name="Ground" type="Sprite3D" parent="."]
transform = Transform( 1, 0, 0, 0, -4.37114e-08, 1, 0, -1, -4.37114e-08, 0, 0, 0 )
pixel_size = 0.5
shaded = true
alpha_cut = 1
texture = ExtResource( 1 )

[node name="StaticBody" type="StaticBody" parent="Ground"]
collision_layer = 32768

[node name="CollisionShape" type="CollisionShape" parent="Ground/StaticBody"]
shape = SubResource( 29 )

[node name="CollisionDetections" type="Viewport" parent="."]
size = Vector2( 8, 8 )
transparent_bg = true
handle_input_locally = false
hdr = false
render_target_update_mode = 3
script = ExtResource( 4 )

[node name="Camera" type="Camera" parent="CollisionDetections"]
transform = Transform( 1, 0, 0, 0, -4.37114e-08, 1, 0, -1, -4.37114e-08, 0, -0.634983, 2.7756e-08 )
cull_mask = 1048574
h_offset = -0.1
v_offset = 0.2
projection = 1
size = 1.75
near = 0.02
far = 232.8

[node name="Player" type="Spatial" parent="."]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.07806, 0 )
script = ExtResource( 2 )
ui_path = NodePath("../Control")

[node name="Camera" type="Camera" parent="Player"]
transform = Transform( 0.629225, -0.716646, 0.300823, 0, 0.387049, 0.922059, -0.777223, -0.580183, 0.243541, 7.74057, 23.9992, 6.67169 )
fov = 50.0

[node name="MeshInstance" type="MeshInstance" parent="Player"]
transform = Transform( 0.5, 0, 0, 0, 1, 0, 0, 0, 0.5, 0, -0.0567212, 0 )
layers = 3
mesh = SubResource( 1 )

[node name="BeamShader" type="Particles" parent="."]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0.309655, 1.02217, 12.9406 )
layers = 3
amount = 200
lifetime = 3.0
visibility_aabb = AABB( -15.4477, -3.26178, -16.006, 30.8954, 6.52356, 32.012 )
local_coords = false
process_material = SubResource( 16 )
draw_pass_1 = SubResource( 14 )
script = ExtResource( 6 )

[node name="MovingBallProcessMaterial" type="Particles" parent="."]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 3.04358, 2.66811, -3.62144 )
visible = false
layers = 3
emitting = false
amount = 203
lifetime = 10.0
one_shot = true
explosiveness = 0.5
process_material = SubResource( 6 )
draw_pass_1 = SubResource( 5 )

[node name="BeamProcessMaterial" type="Particles" parent="."]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -4.33123, 1.02217, 6.08643 )
visible = false
cast_shadow = 0
amount = 200
lifetime = 3.0
local_coords = false
process_material = SubResource( 12 )
draw_pass_1 = SubResource( 14 )

[node name="Enemy" type="Spatial" parent="."]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -11.3508, 1.1649, 0 )
script = ExtResource( 3 )

[node name="Shield" type="Area" parent="Enemy"]
collision_layer = 2
input_ray_pickable = false
monitorable = false
script = ExtResource( 8 )

[node name="CollisionShape" type="CollisionShape" parent="Enemy/Shield"]
shape = SubResource( 42 )

[node name="MeshInstance" type="MeshInstance" parent="Enemy/Shield"]
mesh = SubResource( 40 )

[node name="AnimationPlayer" type="AnimationPlayer" parent="Enemy/Shield"]
anims/Hit = SubResource( 43 )
anims/RESET = SubResource( 44 )

[node name="gem" type="MeshInstance" parent="Enemy"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -0.199103, 0 )
mesh = ExtResource( 10 )
skeleton = NodePath("../..")
material/0 = SubResource( 45 )

[node name="Area" type="Area" parent="Enemy"]
collision_layer = 2
input_ray_pickable = false
monitorable = false

[node name="CollisionShape" type="CollisionShape" parent="Enemy/Area"]
shape = SubResource( 33 )

[node name="AnimationPlayer" type="AnimationPlayer" parent="Enemy"]
autoplay = "Spin"
anims/RESET = SubResource( 38 )
anims/Spin = SubResource( 39 )

[connection signal="input_event" from="Ground/StaticBody" to="Player" method="_on_StaticBody_input_event"]
[connection signal="body_entered" from="Enemy/Shield" to="Enemy/Shield" method="_on_Shield_body_entered"]
[connection signal="body_entered" from="Enemy/Area" to="Enemy" method="_on_Area_body_entered"]
